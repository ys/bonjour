{{ define "main" }}

<div class="z-20 prose mb-16 with-links relative">
  {{ .Content }}
</div>
{{end}}
{{ define "full" }}
{{ $paginator := (.Paginate (where .RegularPages ".Params.archived" "!=" true) 250) }}
{{ $allimages := slice }}
{{ range $index, $page := $paginator.Pages }}
  {{ $images := .Resources.ByType "image" }}
  {{ $src := $images.GetMatch "cover" }}
  {{ $src := $images.GetMatch "*feature*" }}
  {{ $src := cond (ne $src nil) $src ($images.GetMatch "{*cover*,*thumbnail*}") }}
  {{ $src := cond (ne $src nil) $src (index $images 0) }}

  {{ if $src }}
    {{ $allimages = $allimages | append (dict "Image" $src "Page" $page) }}
  {{ end }}
{{ end }}
{{ $rows := dict }}
{{ $columns := dict }}
{{ $rowid := 0 }}
{{ $colid := 0 }}
{{ $possibilities := (slice    3 ) }}
{{ $itemsonrow := index (shuffle $possibilities) 0 }}
{{ range $index, $img := $allimages }}
  {{ $columns = merge $columns (dict (string (mod $index $itemsonrow)) (dict "Images" (slice $img)))}}
  {{ $colid = add $colid 1 }}
  {{ if eq $colid $itemsonrow }}
    {{ $rows = merge $rows (dict (string $rowid) $columns) }}
    {{ $itemsonrow = index (shuffle $possibilities) 0 }}
    {{ $columns = dict }}
    {{ $rowid = add $rowid 1 }}
    {{ $colid = 0 }}
  {{ end }}
{{ end }}
  {{ $rows = merge $rows (dict (string $rowid) $columns) }}
  <div class="max-w-6xl">
      {{ partial "grid" $rows }}
  </div>
  {{ end }}
