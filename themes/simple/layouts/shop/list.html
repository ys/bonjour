{{ define "main" }}
  {{ if .Content }}
    <div class="z-20 dark:prose-invert prose mb-8 with-links relative">
      {{ .Content }}
    </div>
  {{ end }}
{{ end }}

{{ define "full" }}
  {{ $paginator := (.Paginate (where .RegularPages ".Params.archived" "!=" true) 250) }}
  <div class="w-full px-4 mt-0">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 2xl:grid-cols-5 gap-4 md:gap-6">
      {{ range $paginator.Pages }}
        {{ $color := "yellow" }}
        {{ range first 1 (shuffle $.Site.Params.themeColors) }}
          {{ $color = . }}
        {{ end }}
        {{ with .Params.color }}
          {{ $color = . }}
        {{ end }}

        {{ $images := .Resources.ByType "image" }}
        {{ $src := $images.GetMatch "cover" }}
        {{ $src := $images.GetMatch "*feature*" }}
        {{ $src := cond (ne $src nil) $src ($images.GetMatch "{*cover*,*thumbnail*}") }}
        {{ $src := cond (ne $src nil) $src (index $images 0) }}
        {{ $s := newScratch }}
        {{ partial "responsive-img-data" (dict "src" $src "scratch" $s) }}

        {{ $priceId := .Params.price_id }}
        {{ if and (ne hugo.Environment "production") .Params.testing_price_id }}
          {{ $priceId = .Params.testing_price_id }}
        {{ end }}
        <article class="group" {{ with $priceId }}data-price-id="{{ . }}"{{ end }}>
          <a href="{{ .RelPermalink }}" class="block">
            <div class="transition-all duration-300 group-hover:-translate-y-1">
              <picture class="aspect-square relative block overflow-hidden bg-gray-100 dark:bg-gray-800">
                {{ if .Params.soldout }}
                  <div class="absolute inset-0 bg-black/40 z-10"></div>
                  <span class="absolute top-2 left-2 bg-black/80 text-white text-xs font-bold px-2 py-1 z-20 font-sans uppercase tracking-wide">Sold out</span>
                {{ end }}
                {{ if $s.Get "has_avif" }}
                  <source type="image/avif" srcset="{{ $s.Get "srcset_avif" }}" sizes="(min-width: 1536px) 20vw, (min-width: 768px) 33vw, (min-width: 640px) 50vw, 100vw">
                {{ end }}
                <img
                  loading="lazy"
                  style="background: url(data:image/webp;base64,{{ ($s.Get "lqip").Content | base64Encode }}); background-size: cover"
                  alt="{{ .Description }}"
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                  {{ if not ($s.Get "is_gif") }}
                    srcset="{{ $s.Get "srcset_webp" }}"
                    sizes="(min-width: 1536px) 20vw, (min-width: 768px) 33vw, (min-width: 640px) 50vw, 100vw"
                  {{ end }}
                  src="{{ ($s.Get "default").RelPermalink }}"
                  width="{{ $s.Get "width" }}"
                  height="{{ $s.Get "height" }}"
                />
              </picture>
              <div class="mt-2">
                <h2 class="font-sans text-lg font-bold group-hover:text-{{ $color }} transition-colors duration-200 line-clamp-2">
                  {{ .Title | markdownify }}
                </h2>
                <p class="font-sans text-sm mt-1 text-gray-900 dark:text-gray-100 shop-pricetag">
                  {{ with .Params.pricetag }}
                    {{ . | markdownify }}
                  {{ else }}
                    {{ .Date.Day }} {{ index .Site.Data.mois (printf "%d" .Date.Month) }} {{ .Date.Year }}
                  {{ end }}
                </p>
              </div>
            </div>
          </a>
        </article>
      {{ end }}
    </div>
  </div>
{{ end }}
