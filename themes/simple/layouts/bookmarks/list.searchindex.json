{{- $headless := .Sites.First.GetPage "/bookmarks/images" -}}
[
{{ $paginator := (.Paginate (where (where .Sites.First.RegularPages ".Params.archived" "!=" true) "Type" "bookmarks") 2500) }}
{{ range $index, $page := $paginator.Pages }}
    {{ $src := $headless.Resources.GetMatch $page.Params.uuid }}
    {{ if $src }}
      {{ $src = $src.Fill "450x300 webp" }}
      {{- $entry = merge $entry (dict "img" $src.RelPermalink) -}}
    {{ end }}
    {{- if gt $index 0 -}} , {{- end -}}
    {{- $entry := dict "uuid" $page.Params.uuid "title" $page.Title -}}
    {{- $entry = merge $entry (dict "content" ($page.Content | htmlUnescape)) -}}
    {{- $entry = merge $entry (dict "description" ($page.Content | default $page.Description)) -}}
    {{- $entry = merge $entry (dict "emoji" (partial "emoji" .)) -}}
      {{ $color := "accent" }}
      {{range first 1 (shuffle (slice "accent" "sunray" "purpleheart" "forest" "jazzberry" "rose" "teal" "tuscan")) }}
        {{ $color = . }}
      {{ end }}
  {{ if $src }}
    {{ range first 1 $src.Colors }}
      {{ $color = printf "[%s]" . }}
    {{ end }}
  {{ end }}

    {{- $entry = merge $entry (dict "color" $color) -}}
    {{- $entry = merge $entry (dict "bookmarkOf" $page.Params.bookmarkOf) -}}

    {{- $entry | jsonify ( dict "noHTMLEscape" true) -}}
  {{- end -}}
]
