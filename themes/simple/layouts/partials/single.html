{{ partial "article_header" . }}
<div data-pswp class="{{ if eq .Type "shop" }}flex flex-col md:flex-row md:-mx-32 {{ end }}mb-10 font-ffserif content-{{ with .Params.color }}{{ . }}{{ else }}accent{{ end }}">
  {{ with .Params.grid }}
    <div  class="w-4/6">
      {{ $rowsslice := split . "/" }}
      {{ $rows := dict }}
      {{ range $rowIndex, $row := $rowsslice}}
        {{ $columnsslice := split $row "|" }}
        {{ $columns := dict }}
        {{ range $columnIndex, $column := $columnsslice }}
          {{ $imagesslice := split $column " - " }}
          {{ $images := slice }}
          {{ range $imagesslice }}
              {{ $name := trim . " " }}
              {{ if in $name ":" }}
                {{ $ratio := split $name ":" }}
                {{ $blank := dict "Blank" true "Image" (dict "Height" (int (index $ratio 1)) "Width" (int (index $ratio 0))) }}
                {{ $images = $images | append $blank }}
              {{ else }}
                {{ $src := $.Page.Resources.GetMatch (printf "*%s*" $name) }}
                {{ if $src }}
                  {{ $images = $images | append (dict "Image" $src) }}
                {{ end }}
              {{ end }}
          {{ end }}
          {{ $columns = merge $columns (dict (string $columnIndex) (dict "Images" $images)) }}
        {{ end }}
        {{ $rows = merge $rows (dict (string $rowIndex) $columns) }}
      {{ end }}
      {{ partial "grid" $rows }}
    </div>
  {{ end }}
  <div  class="post {{if eq .Type "shop" }}w-2/6 pl-8 {{end}}">
    {{.Content}}
    <div id="product"></div>
  </div>
  {{ if eq .Type "newsletter" }}
    <h2 class="text-xl font-semibold text-darker dark:text-gray-100">Lisez la derni√®re</h2>
    {{ range first 1 (where .Site.RegularPages ".Params.newsletter" true)  }}
      {{ partial "title" . }}
    {{ end }}
  {{ end }}
  {{ if (in .Site.Params.showFooter .Type) }}
  <hr class="line"/>
    {{ partial "article_footer" . }}
    <div class="pt-8">
      <hr class="" />
      {{ partial "recent_posts" . }}
    </div>
  {{ end }}
</div>
{{ if eq .Type "shop" }}
<script type="text/javascript">
/*<![CDATA[*/
(function () {
 var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
 if (window.ShopifyBuy) {
  if (window.ShopifyBuy.UI) {
    ShopifyBuyInit();
  } else {
 loadScript();
 }
 } else {
 loadScript();
 }
 function loadScript() {
 var script = document.createElement('script');
 script.async = true;
 script.src = scriptURL;
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
 script.onload = ShopifyBuyInit;
 }
 function ShopifyBuyInit() {
 var client = ShopifyBuy.buildClient({
   domain: '{{ .Site.Params.shopify.name }}.myshopify.com',
   storefrontAccessToken: '{{- .Site.Params.shopify.accessToken -}}',
});
ShopifyBuy.UI.onReady(client).then(function (ui) {
    ui.createComponent('product', {
      id: '{{ .Params.productID }}',
node: document.getElementById('product'),
moneyFormat: '%E2%82%AC%7B%7Bamount_with_comma_separator%7D%7D',
options: {
  product: {
    iframe: false,
    buttonDestination: "checkout",
    contents: {
    title: false,
    },
    text: {
      button: "Buy now"
    }
  }
}
  });
});
}
})();
/*]]>*/
</script>
{{ end }}
