<!DOCTYPE html>
<html>
  {{ partial "header" .}}
  <body>
    <div class="wrapper">
      {{ block "header" . }}
        {{ $image := .Resources.GetMatch "cover" | default (index (.Resources.ByType "image") 0) }}
        <header {{ with $image }}style="background-image: url('{{ .Permalink }}')"{{ end }} class="hero_header">
          {{ partial "main_menu" . }}
          <h1><a href="/">{{ .Site.Title }}</a></h1>
        </header>
      {{ end }}
      {{ block "main" . }}
        <!-- The part of the page that begins to differ between templates -->
      {{ end }}
    </div>
    {{ partial "footer" .}}
    {{ template "_internal/google_analytics.html" . }}
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
    {{ $.Scratch.Set "jslibs" slice }}
    {{ $libs := slice "js/flickity.pkgd.min.js" "js/bg-lazyload.js" "js/medium-zoom.min.js" "js/iolazy.min.js" }}
    {{ range $libs }}
      {{ $.Scratch.Add "jslibs" (resources.Get . ) }}
    {{ end }}
    {{ $js := .Scratch.Get "jslibs" | resources.Concat "js/main.js" }}
    {{ if .Site.IsServer }}
      <script src="{{ $js.Permalink }}"></script>
    {{ else }}
      {{ $js := $js | minify | fingerprint }}
      <script src="{{ $js.Permalink }}" integrity="{{ $js.Data.Integrity }}"></script>
    {{ end }}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        new IOlazy();
        mediumZoom(document.querySelectorAll('[data-action="zoom"]'), {margin: 20});
        {{ block "js" . }}
        {{ end }}
      })
    </script>
  </body>
</html>
